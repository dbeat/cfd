
<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta charset="utf-8" />
    <title>cfd.models_2d.axi_symmetric.poiseuille_axi &#8212; cfd  documentation</title>
    <link rel="stylesheet" href="../../../../_static/alabaster.css" type="text/css" />
    <link rel="stylesheet" href="../../../../_static/pygments.css" type="text/css" />
    <link rel="stylesheet" type="text/css" href="../../../../_static/graphviz.css" />
    <script type="text/javascript" id="documentation_options" data-url_root="../../../../" src="../../../../_static/documentation_options.js"></script>
    <script type="text/javascript" src="../../../../_static/jquery.js"></script>
    <script type="text/javascript" src="../../../../_static/underscore.js"></script>
    <script type="text/javascript" src="../../../../_static/doctools.js"></script>
    <script type="text/javascript" src="../../../../_static/language_data.js"></script>
    <script async="async" type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/latest.js?config=TeX-AMS-MML_HTMLorMML"></script>
    <link rel="shortcut icon" href="../../../../_static/favicon.png"/>
    <link rel="index" title="Index" href="../../../../genindex.html" />
    <link rel="search" title="Search" href="../../../../search.html" /> 
<link rel="stylesheet" type="text/css"
     href="../../../../_static/style.css" />

  </head><body>
  <div class="document">
    
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
            <p class="logo"><a href="../../../../index.html">
              <img class="logo" src="../../../../_static/logo.png" alt="Logo"/>
            </a></p><h3>Navigation</h3>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../../installation.html">Installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../usage.html">Usage</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../theory.html">Theory</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../package/index.html">Packages</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../bibliography.html">References</a></li>
</ul>


<div id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="../../../../search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" />
      <input type="submit" value="Go" />
    </form>
    </div>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="documentwrapper">
        <div class="bodywrapper">
          

          <div class="body" role="main">
            
  <h1>Source code for cfd.models_2d.axi_symmetric.poiseuille_axi</h1><div class="highlight"><pre>
<span></span><span class="c1"># -*- coding: utf-8 -*-</span>
<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">models_2d.axi_symmetric.poiseuille_axi.py</span>
<span class="sd">November 14, 2019</span>
<span class="sd">@author Francois Roy</span>
<span class="sd">&quot;&quot;&quot;</span>
<span class="kn">import</span> <span class="nn">dolfin</span>
<span class="kn">from</span> <span class="nn">scipy.constants</span> <span class="kn">import</span> <span class="n">g</span>

<span class="kn">from</span> <span class="nn">utils</span> <span class="kn">import</span> <span class="o">*</span>
<span class="kn">from</span> <span class="nn">fem.geom_feats.utils</span> <span class="kn">import</span> <span class="n">check_dimension</span>
<span class="kn">import</span> <span class="nn">fem</span>
<span class="kn">from</span> <span class="nn">fem.solver_feats.ipcs</span> <span class="kn">import</span> <span class="n">Ipcs</span>


<div class="viewcode-block" id="PoiseuilleAxi"><a class="viewcode-back" href="../../../../package/cfd.html#cfd.models_2d.axi_symmetric.poiseuille_axi.PoiseuilleAxi">[docs]</a><span class="k">class</span> <span class="nc">PoiseuilleAxi</span><span class="p">(</span><span class="n">fem</span><span class="o">.</span><span class="n">Model</span><span class="p">):</span>
    <span class="sa">r</span><span class="sd">&quot;&quot;&quot;The unsteady laminar flow of a newtonian, incompressible fluid in</span>
<span class="sd">    a circular pipe, termed Poiseuille flow, has an analytical solution.</span>

<span class="sd">    we consider here a fluid of constant density :math:`\rho` and viscosity</span>
<span class="sd">    :math:`\mu`, flowing in a vertical tube of length :math:`L` and radius</span>
<span class="sd">    :math:`R`. The liquid flows downward under the influence of a pressure</span>
<span class="sd">    difference and gravity. The tube length is specified to be large  with</span>
<span class="sd">    respect to the tube radius, so that end effects will be unimportant</span>
<span class="sd">    throughout most of the tube (flow parallel to the tube wall at the inlet</span>
<span class="sd">    and outlet).</span>

<span class="sd">    We assume a negligible radial component of the velocity, a no-slip</span>
<span class="sd">    condition at the wall, i.e. :math:`u_z=0` at</span>
<span class="sd">    :math:`r=R`, and axial symmetry, i.e.</span>
<span class="sd">    :math:`\frac{\partial u_z}{\partial r}=0`, at :math:`r=0`.</span>

<span class="sd">    The equations representing the fluid dynamics are obtained from the</span>
<span class="sd">    conservation of mass (continuity) and momentum (Navier-Stokes).</span>

<span class="sd">    For incompressible flow, the continuity equation is:</span>

<span class="sd">    .. math::  \nabla\cdot \mathbf{u} = 0</span>

<span class="sd">    and the Navier-Stokes equation becomes:</span>

<span class="sd">    .. math:: \rho\left(\frac{\partial\mathbf{u}}{\partial t} +</span>
<span class="sd">        \mathbf{u}\cdot\nabla \mathbf{u}\right) = -\nabla p +</span>
<span class="sd">        \nabla\cdot\bar{\tau} + \mathbf{F}</span>

<span class="sd">    where :math:`\mathbf{u}` is the fluid velocity,  :math:`p` is the pressure</span>
<span class="sd">    and where :math:`\mathbf{F}=\rho\mathbf{g}` is the volume force due to</span>
<span class="sd">    gravity. The stress tensor :math:`\bar{\tau}` is denoted by</span>

<span class="sd">    .. math:: \bar{\tau} = 2\mu\bar{\epsilon}</span>

<span class="sd">    where</span>

<span class="sd">    .. math:: \bar{\epsilon} = \frac{1}{2}\left(\nabla \mathbf{u} +</span>
<span class="sd">        (\nabla\mathbf{u})^T \right)</span>

<span class="sd">    is the strain-rate tensor.</span>

<span class="sd">    Note that the Navier-Stokes equations are considered time-dependent.</span>

<span class="sd">    **Cylindrical Coordinates**</span>

<span class="sd">    The Navier-Stokes equation is written by</span>
<span class="sd">    components in cylindrical coordinates (:math:`r,~\theta,~z`):</span>

<span class="sd">    :math:`r`-component:</span>

<span class="sd">    .. math::  \rho\left(\frac{\partial}{\partial t}u_r+</span>
<span class="sd">        u_r\frac{\partial}{\partial r}u_r+\frac{u_\theta}{r}\frac{\partial}</span>
<span class="sd">        {\partial \theta}u_r+u_z\frac{\partial}{\partial z}u_r</span>
<span class="sd">        -\frac{u_\theta^2}{r}\right) = -\frac{\partial}{\partial r}p +</span>
<span class="sd">        \mu\left(\frac{\partial}{\partial r}\left(\frac{1}{r}</span>
<span class="sd">        \frac{\partial}{\partial r}(ru_r)\right) +</span>
<span class="sd">        \frac{1}{r^2}\frac{\partial^2}{\partial \theta^2}u_r+</span>
<span class="sd">        \frac{\partial^2}{\partial z^2}u_r-</span>
<span class="sd">        \frac{2}{r^2}\frac{\partial}{\partial \theta}u_\theta\right) +\rho g_r</span>

<span class="sd">    :math:`\theta`-component:</span>

<span class="sd">    .. math::  \rho\left(\frac{\partial}{\partial t}u_\theta+</span>
<span class="sd">        u_r\frac{\partial}{\partial r}u_\theta+\frac{u_\theta}{r}\frac{\partial}</span>
<span class="sd">        {\partial \theta}u_\theta+u_z\frac{\partial}{\partial z}u_\theta</span>
<span class="sd">        +\frac{u_ru_\theta}{r}\right) = -\frac{1}{r}\frac{\partial}</span>
<span class="sd">        {\partial \theta}p +</span>
<span class="sd">        \mu\left(\frac{\partial}{\partial r}\left(\frac{1}{r}</span>
<span class="sd">        \frac{\partial}{\partial r}(ru_\theta)\right) +</span>
<span class="sd">        \frac{1}{r^2}\frac{\partial^2}{\partial \theta^2}u_\theta+</span>
<span class="sd">        \frac{\partial^2}{\partial z^2}u_\theta+</span>
<span class="sd">        \frac{2}{r^2}\frac{\partial}{\partial \theta}u_r\right) +\rho g_\theta</span>

<span class="sd">    :math:`z`-component:</span>

<span class="sd">    .. math::  \rho\left(\frac{\partial}{\partial t}u_z+</span>
<span class="sd">        u_r\frac{\partial}{\partial r}u_z+\frac{u_\theta}{r}\frac{\partial}</span>
<span class="sd">        {\partial \theta}u_z+u_z\frac{\partial}{\partial z}u_z\right)</span>
<span class="sd">         = -\frac{\partial}</span>
<span class="sd">        {\partial z}p +</span>
<span class="sd">        \mu\left(\frac{1}{r}\frac{\partial}{\partial r}\left(r</span>
<span class="sd">        \frac{\partial}{\partial r}u_z\right) +</span>
<span class="sd">        \frac{1}{r^2}\frac{\partial^2}{\partial \theta^2}u_z+</span>
<span class="sd">        \frac{\partial^2}{\partial z^2}u_z\right) +\rho g_z</span>


<span class="sd">    The continuity equation in cylindrical component is:</span>

<span class="sd">    .. math:: \frac{1}{r}\left(\frac{\partial}{\partial r}(ru_r)</span>
<span class="sd">        +\frac{\partial}{\partial \theta}(u_\theta)\right) +</span>
<span class="sd">        \frac{\partial}{\partial z} u_z = 0</span>

<span class="sd">    **Axisymmetric Formulation**</span>

<span class="sd">    In an axisymmetric model there is no gradient in the azimuthal</span>
<span class="sd">    direction :math:`\theta`. If we also assume that the</span>
<span class="sd">    :math:`\theta`-component of the velocity field is zero, the</span>
<span class="sd">    :math:`\theta`-component of the Navier-Stokes equation is removed and</span>
<span class="sd">    the continuity/momentum equations become:</span>

<span class="sd">    Continuity:</span>

<span class="sd">    .. math:: \frac{u_r}{r}+\frac{\partial}{\partial r}u_r</span>
<span class="sd">        + \frac{\partial}{\partial z} u_z = 0</span>

<span class="sd">    Navier-Stokes, :math:`r`-component:</span>

<span class="sd">    .. math::  \rho\left(\frac{\partial}{\partial t}u_r+</span>
<span class="sd">        u_r\frac{\partial}{\partial r}u_r</span>
<span class="sd">        +u_z\frac{\partial}{\partial z}u_r\right)</span>
<span class="sd">         = -\frac{\partial}{\partial r}p +</span>
<span class="sd">        \mu\left(\frac{\partial}{\partial r}\left(\frac{u_r}{r}+</span>
<span class="sd">        \frac{\partial}{\partial r}u_r\right) +</span>
<span class="sd">        \frac{\partial^2}{\partial z^2}u_r\right)</span>

<span class="sd">    Navier-Stokes, :math:`z`-component:</span>

<span class="sd">    .. math::  \rho\left(\frac{\partial}{\partial t}u_z+</span>
<span class="sd">        u_r\frac{\partial}{\partial r}u_z</span>
<span class="sd">        +u_z\frac{\partial}{\partial z}u_z\right)</span>
<span class="sd">         = -\frac{\partial}</span>
<span class="sd">        {\partial z}p +</span>
<span class="sd">        \mu\left(\frac{1}{r}\frac{\partial}{\partial r}\left(r</span>
<span class="sd">        \frac{\partial}{\partial r}u_z\right) +</span>
<span class="sd">        \frac{\partial^2}{\partial z^2}u_z\right) +\rho g_z</span>

<span class="sd">    Note that the gravity term only have a :math:`z`-component.</span>

<span class="sd">    :param tag: The model name -- default pa</span>
<span class="sd">    :param size: The radius and length of the pipe [radius, height],</span>
<span class="sd">      --default 20 mm and 100 mm.</span>
<span class="sd">    :param mu: Dynamic viscosity -- default 8.548e-4 Pa.s (water 300 K).</span>
<span class="sd">    :param rho: Density -- default 996.534 kg/m3 (water 300 K).</span>
<span class="sd">    :param pin: Inlet pressure -- default 8 Pa.</span>
<span class="sd">    :param pout: Outlet pressure -- default 0 Pa.</span>
<span class="sd">    :param ne_r: Number of element along the radius of the pipe -- default 10.</span>
<span class="sd">    :param ne_z: Number of element along the height of the pipe -- default 100.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">tag</span><span class="o">=</span><span class="s1">&#39;pa&#39;</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="n">Q_</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">([</span><span class="mf">20.0</span><span class="p">,</span> <span class="mf">100.0</span><span class="p">]),</span> <span class="s2">&quot;mm&quot;</span><span class="p">),</span>
                 <span class="n">mu</span><span class="o">=</span><span class="n">Q_</span><span class="p">(</span><span class="mf">8.548e-4</span><span class="p">,</span> <span class="s1">&#39;Pa*s&#39;</span><span class="p">),</span> <span class="n">rho</span><span class="o">=</span><span class="n">Q_</span><span class="p">(</span><span class="mf">996.534</span><span class="p">,</span> <span class="s1">&#39;kg/m**3&#39;</span><span class="p">),</span>
                 <span class="n">pin</span><span class="o">=</span><span class="n">Q_</span><span class="p">(</span><span class="mf">8.0</span><span class="p">,</span> <span class="s1">&#39;Pa&#39;</span><span class="p">),</span> <span class="n">pout</span><span class="o">=</span><span class="n">Q_</span><span class="p">(</span><span class="mf">0.0</span><span class="p">,</span> <span class="s1">&#39;Pa&#39;</span><span class="p">),</span> <span class="n">ne_r</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">ne_z</span><span class="o">=</span><span class="mi">100</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">PoiseuilleAxi</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">tag</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_size</span> <span class="o">=</span> <span class="n">size</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="s2">&quot;m&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_mu</span> <span class="o">=</span> <span class="n">mu</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="s2">&quot;Pa*s&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_rho</span> <span class="o">=</span> <span class="n">rho</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="s2">&quot;kg/m**3&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_pin</span> <span class="o">=</span> <span class="n">pin</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="s1">&#39;Pa&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_pout</span> <span class="o">=</span> <span class="n">pout</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="s1">&#39;Pa&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_ne_r</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">ne_r</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_ne_z</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">ne_z</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add_child</span><span class="p">(</span><span class="n">fem</span><span class="o">.</span><span class="n">Component</span><span class="p">(</span><span class="s1">&#39;comp&#39;</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="n">is_axi</span><span class="o">=</span><span class="kc">True</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_geom</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">geom</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_mesh</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">mesh</span><span class="p">()</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">size</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sa">r</span><span class="sd">&quot;&quot;&quot;The dimensions of the pipe [radius, height]&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_size</span>

    <span class="nd">@size</span><span class="o">.</span><span class="n">setter</span>
    <span class="k">def</span> <span class="nf">size</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="c1"># raise invalid syntax if can&#39;t convert to string</span>
        <span class="n">name</span> <span class="o">=</span> <span class="n">inspect</span><span class="o">.</span><span class="n">stack</span><span class="p">()[</span><span class="mi">0</span><span class="p">][</span><span class="mi">3</span><span class="p">]</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">value</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">2</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;not a valid number of arguments&quot;</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">2</span><span class="p">):</span>
            <span class="n">check_dimension</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="n">name</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_size</span> <span class="o">=</span> <span class="n">value</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="s1">&#39;m&#39;</span><span class="p">)</span>

<div class="viewcode-block" id="PoiseuilleAxi.axial_line"><a class="viewcode-back" href="../../../../package/cfd.html#cfd.models_2d.axi_symmetric.poiseuille_axi.PoiseuilleAxi.axial_line">[docs]</a>    <span class="k">def</span> <span class="nf">axial_line</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sa">r</span><span class="sd">&quot;&quot;&quot;Define an axial line on which the solution :math:`p` can be</span>
<span class="sd">        mapped (interpolated).&quot;&quot;&quot;</span>
        <span class="n">z</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_size</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">magnitude</span>
        <span class="k">return</span> <span class="n">Q_</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">z</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_ne_z</span> <span class="o">+</span> <span class="mi">1</span><span class="p">),</span> <span class="s1">&#39;m&#39;</span><span class="p">)</span></div>

<div class="viewcode-block" id="PoiseuilleAxi.compute"><a class="viewcode-back" href="../../../../package/cfd.html#cfd.models_2d.axi_symmetric.poiseuille_axi.PoiseuilleAxi.compute">[docs]</a>    <span class="k">def</span> <span class="nf">compute</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">t_end</span><span class="o">=</span><span class="n">Q_</span><span class="p">(</span><span class="mf">10.0</span><span class="p">,</span> <span class="s1">&#39;s&#39;</span><span class="p">),</span> <span class="n">num_steps</span><span class="o">=</span><span class="mi">500</span><span class="p">):</span>
        <span class="sa">r</span><span class="sd">&quot;&quot;&quot;For incompressible flow, the continuity equation is:</span>

<span class="sd">        .. math::  \nabla\cdot \mathbf{u} = 0</span>

<span class="sd">        and the Navier-Stokes equation becomes:</span>

<span class="sd">        .. math:: \rho\left(\frac{\partial\mathbf{u}}{\partial t} +</span>
<span class="sd">            \mathbf{u}\cdot\nabla \mathbf{u}\right) =</span>
<span class="sd">            \nabla\cdot\bar{\pi} + \mathbf{F}</span>

<span class="sd">        where :math:`\mathbf{u}` is the fluid velocity,  :math:`p` is the</span>
<span class="sd">        pressure and where :math:`\mathbf{F}=\rho\mathbf{g}` is the volume</span>
<span class="sd">        force due to gravity. The molecular stress tensor :math:`\bar{\pi}` is</span>
<span class="sd">        denoted by:</span>

<span class="sd">        .. math:: \bar{\pi} = \bar{\tau} - p\bar{I}, \quad \bar{I}\textrm{ is</span>
<span class="sd">            the unit tensor}</span>

<span class="sd">        where :math:`\bar{\tau}` is the viscous stress tensor defined by:</span>

<span class="sd">        .. math:: \bar{\tau} = 2\mu\bar{\epsilon}</span>

<span class="sd">        and where</span>

<span class="sd">        .. math:: \bar{\epsilon} = \frac{1}{2}\left(\nabla \mathbf{u} +</span>
<span class="sd">            (\nabla\mathbf{u})^T \right)</span>

<span class="sd">        is the strain-rate tensor.</span>

<span class="sd">        The variational formulation of the viscous term is:</span>

<span class="sd">        .. math:: \int_\Omega \left(\nabla\cdot\bar{\pi}\right)\cdot</span>
<span class="sd">            \mathbf{v}d\mathbf{x}</span>

<span class="sd">        Since the term :math:`\nabla\cdot\bar{\pi}` contains second-order</span>
<span class="sd">        derivatives of the velocity field :math:`\mathbf{u}`, we integrate this</span>
<span class="sd">        term by parts:</span>

<span class="sd">        .. math:: -\int_\Omega\left(\nabla\cdot\bar{\pi}\right)\cdot</span>
<span class="sd">            \mathbf{v}d\mathbf{x} = \int_\Omega \bar{\pi}:\nabla</span>
<span class="sd">            \mathbf{v}d\mathbf{x}-\int_{\delta\Omega}\left(\bar{\pi}</span>
<span class="sd">            \cdot\hat{\mathbf{n}}\right)\cdot\mathbf{v}ds</span>

<span class="sd">        where the colon operator is the inner product (Frobenius inner-product)</span>
<span class="sd">        between tensors, and :math:`\hat{\mathbf{n}}` is the outward unit</span>
<span class="sd">        normal at the boundary (traction, or stress vector).</span>

<span class="sd">        In cylindrical coordinates (:math:`r,~ \theta,~ z`), the gradient of</span>
<span class="sd">        the velocity field :math:`\mathbf{u}` writes</span>

<span class="sd">        .. math:: \nabla\cdot{\mathbf{u}} = \left(</span>
<span class="sd">            \begin{array}{ccc}</span>
<span class="sd">              \frac{\partial u_r}{\partial r} &amp;</span>
<span class="sd">              \frac{\partial u_\theta}{\partial r} &amp;</span>
<span class="sd">              \frac{\partial u_z}{\partial r}\\</span>
<span class="sd">              \frac{1}{r}\frac{\partial u_r}{\partial \theta}-</span>
<span class="sd">              \frac{u_\theta}{r}&amp;</span>
<span class="sd">              \frac{1}{r}\frac{\partial u_\theta}{\partial \theta}+</span>
<span class="sd">               \frac{u_r}{r}&amp;</span>
<span class="sd">              \frac{1}{r}\frac{\partial u_z}{\partial \theta}\\</span>
<span class="sd">              \frac{\partial u_r}{\partial z} &amp;</span>
<span class="sd">              \frac{\partial u_\theta}{\partial z} &amp;</span>
<span class="sd">              \frac{\partial u_z}{\partial z}</span>
<span class="sd">            \end{array}</span>
<span class="sd">            \right)</span>

<span class="sd">        The strain-rate tensor :math:`\bar{\epsilon}` is then:</span>

<span class="sd">        .. math:: \bar{\epsilon} = \left(</span>
<span class="sd">            \begin{array}{ccc}</span>
<span class="sd">              \frac{\partial u_r}{\partial r} &amp;</span>
<span class="sd">              \frac{1}{2}\left(\frac{\partial u_\theta}{\partial r} +</span>
<span class="sd">              \frac{1}{r}\frac{\partial u_\theta}{\partial \theta}-</span>
<span class="sd">               \frac{u_\theta}{r}\right)&amp;</span>
<span class="sd">              \frac{1}{2}\left(\frac{\partial u_z}{\partial r}+</span>
<span class="sd">              \frac{\partial u_r}{\partial z}\right)\\</span>
<span class="sd">              \frac{1}{2}\left(\frac{1}{r}\frac{\partial u_r}{\partial \theta}-</span>
<span class="sd">              \frac{u_\theta}{r}+\frac{\partial u_\theta}{\partial r}\right)&amp;</span>
<span class="sd">              \frac{1}{r}\frac{\partial u_\theta}{\partial \theta}+</span>
<span class="sd">               \frac{u_r}{r}&amp;</span>
<span class="sd">              \frac{1}{2}\left(\frac{1}{r}\frac{\partial u_z}{\partial</span>
<span class="sd">              \theta}+\frac{\partial u_\theta}{\partial z}\right)\\</span>
<span class="sd">              \frac{1}{2}\left(\frac{\partial u_r}{\partial z}</span>
<span class="sd">              +\frac{\partial u_z}{\partial r}\right)&amp;</span>
<span class="sd">              \frac{1}{2}\left(\frac{\partial u_\theta}{\partial z}</span>
<span class="sd">              +\frac{1}{r}\frac{\partial u_z}{\partial \theta}\right)&amp;</span>
<span class="sd">              \frac{\partial u_z}{\partial z}</span>
<span class="sd">            \end{array}</span>
<span class="sd">            \right)</span>

<span class="sd">        From the definition above, the viscous stress tensor :math:`\bar{\tau}`</span>
<span class="sd">        is:</span>

<span class="sd">        .. math:: \bar{\tau} = \mu\left(</span>
<span class="sd">            \begin{array}{ccc}</span>
<span class="sd">              2\frac{\partial u_r}{\partial r} &amp;</span>
<span class="sd">              \frac{\partial u_\theta}{\partial r} +</span>
<span class="sd">              \frac{1}{r}\frac{\partial u_\theta}{\partial \theta}-</span>
<span class="sd">               \frac{u_\theta}{r}&amp;</span>
<span class="sd">              \frac{\partial u_z}{\partial r}+</span>
<span class="sd">              \frac{\partial u_r}{\partial z}\\</span>
<span class="sd">              \frac{1}{r}\frac{\partial u_r}{\partial \theta}-</span>
<span class="sd">              \frac{u_\theta}{r}+\frac{\partial u_\theta}{\partial r}&amp;</span>
<span class="sd">              2\left(\frac{1}{r}\frac{\partial u_\theta}{\partial \theta}+</span>
<span class="sd">               \frac{u_r}{r}\right)&amp;</span>
<span class="sd">              \frac{1}{r}\frac{\partial u_z}{\partial</span>
<span class="sd">              \theta}+\frac{\partial u_\theta}{\partial z}\\</span>
<span class="sd">              \frac{\partial u_r}{\partial z}</span>
<span class="sd">              +\frac{\partial u_z}{\partial r}&amp;</span>
<span class="sd">              \frac{\partial u_\theta}{\partial z}</span>
<span class="sd">              +\frac{1}{r}\frac{\partial u_z}{\partial \theta}&amp;</span>
<span class="sd">              2\frac{\partial u_z}{\partial z}</span>
<span class="sd">            \end{array}</span>
<span class="sd">            \right)</span>

<span class="sd">        and the molecular stress tensor :math:`\bar{\pi}` is:</span>

<span class="sd">        .. math:: \bar{\pi} = \mu\left(</span>
<span class="sd">            \begin{array}{ccc}</span>
<span class="sd">              2\frac{\partial u_r}{\partial r} -\frac{p}{\mu}&amp;</span>
<span class="sd">              \frac{\partial u_\theta}{\partial r} +</span>
<span class="sd">              \frac{1}{r}\frac{\partial u_\theta}{\partial \theta}-</span>
<span class="sd">               \frac{u_\theta}{r}&amp;</span>
<span class="sd">              \frac{\partial u_z}{\partial r}+</span>
<span class="sd">              \frac{\partial u_r}{\partial z}\\</span>
<span class="sd">              \frac{1}{r}\frac{\partial u_r}{\partial \theta}-</span>
<span class="sd">              \frac{u_\theta}{r}+\frac{\partial u_\theta}{\partial r}&amp;</span>
<span class="sd">              2\left(\frac{1}{r}\frac{\partial u_\theta}{\partial \theta}+</span>
<span class="sd">               \frac{u_r}{r}\right) -\frac{p}{\mu} &amp;</span>
<span class="sd">              \frac{1}{r}\frac{\partial u_z}{\partial</span>
<span class="sd">              \theta}+\frac{\partial u_\theta}{\partial z}\\</span>
<span class="sd">              \frac{\partial u_r}{\partial z}</span>
<span class="sd">              +\frac{\partial u_z}{\partial r}&amp;</span>
<span class="sd">              \frac{\partial u_\theta}{\partial z}</span>
<span class="sd">              +\frac{1}{r}\frac{\partial u_z}{\partial \theta}&amp;</span>
<span class="sd">              2\frac{\partial u_z}{\partial z} -\frac{p}{\mu}</span>
<span class="sd">            \end{array}</span>
<span class="sd">            \right)</span>

<span class="sd">        The scalar product (or double dot product) of two tensors is the</span>
<span class="sd">        summed pairwise product of all element of the tensors, i.e.</span>

<span class="sd">        .. math:: \bar{\pi}:\nabla\mathbf{v} =</span>
<span class="sd">            \pi_{rr}\frac{\partial v_r}{\partial r}+</span>
<span class="sd">            \pi_{r\theta}\frac{\partial v_\theta}{\partial r}+\ldots +</span>
<span class="sd">            \pi_{zz}\frac{\partial v_z}{\partial z}</span>

<span class="sd">        and the vector product (or dot product) of a tensor with a vector is</span>
<span class="sd">        just the regular product between a matrix and a vector.</span>

<span class="sd">        .. math:: \bar{\pi}\cdot \hat{\mathbf{n}} = \left(\pi_{rr}n_r+</span>
<span class="sd">            \pi_{r\theta}n_\theta + \pi_{rz}nz\right) \hat{\mathbf{e}}_r +</span>
<span class="sd">            \left(\pi_{\theta r}n_r + \dots\right)\hat{\mathbf{e}}_\theta +</span>
<span class="sd">            \left(\ldots + \pi_{r\theta}n_\theta\right)\hat{\mathbf{e}}_z</span>

<span class="sd">        **Axisymmetric Formulation**</span>

<span class="sd">        We consider a solid of revolution around a fixed axis (Oz), the</span>
<span class="sd">        loading, boundary conditions and material properties are invariant</span>
<span class="sd">        with respect to a rotation along the symmetry axis. The solid</span>
<span class="sd">        cross-section in a plane :math:`\Theta=` cst is represented by</span>
<span class="sd">        a two-dimensional domain :math:`\omega` for which the first spatial</span>
<span class="sd">        variable (x[0] in FEniCS) will represent the radial coordinate</span>
<span class="sd">        :math:`r` whereas the second spatial variable will denote the axial</span>
<span class="sd">        variable :math:`z`.</span>

<span class="sd">        In axisymmetric conditions, the full 3D domain :math:`\Omega` can be</span>
<span class="sd">        decomposed as :math:`\Omega=\omega\times[0;2\pi]` where the interval</span>
<span class="sd">        represents the :math:`\theta` variable. The integration measures</span>
<span class="sd">        therefore reduce to :math:`dx=d\omega\cdot(rd\theta)` and</span>
<span class="sd">        :math:`dS=ds\cdot(rd\theta)` where :math:`dS` is the surface</span>
<span class="sd">        integration measure on the 3D domain :math:`\Omega` and :math:`ds` its</span>
<span class="sd">        counterpart on the cross-section boundary :math:`\partial\omega`.</span>

<span class="sd">        Exploiting the invariance of all fields with respect to :math:`\theta`,</span>
<span class="sd">        we get the variational formulation of the viscous term as:</span>

<span class="sd">         .. math:: -\int_\Omega\left(\nabla\cdot\bar{\pi}\right)\cdot</span>
<span class="sd">            \mathbf{v}d\mathbf{x} = 2\pi\int_\omega \bar{\pi}:\nabla</span>
<span class="sd">            \mathbf{v}rd\omega-2\pi\int_{\delta\omega}\left(\bar{\pi}</span>
<span class="sd">            \cdot\hat{\mathbf{n}}\right)\cdot\mathbf{v}r ds</span>

<span class="sd">        For an axisymmetric model there is no gradient in the azimuthal</span>
<span class="sd">        direction :math:`\theta`. If we also assume that the</span>
<span class="sd">        :math:`\theta`-component of the velocity field is zero, we obtain</span>
<span class="sd">        the gradient of the velocity field:</span>

<span class="sd">        .. math:: \nabla\cdot{\mathbf{u}} = \left(</span>
<span class="sd">            \begin{array}{ccc}</span>
<span class="sd">              \frac{\partial u_r}{\partial r} &amp;</span>
<span class="sd">              0 &amp;</span>
<span class="sd">              \frac{\partial u_z}{\partial r}\\</span>
<span class="sd">              0&amp;</span>
<span class="sd">               \frac{u_r}{r}&amp;</span>
<span class="sd">              0\\</span>
<span class="sd">              \frac{\partial u_r}{\partial z} &amp;</span>
<span class="sd">              0&amp;</span>
<span class="sd">              \frac{\partial u_z}{\partial z}</span>
<span class="sd">            \end{array}</span>
<span class="sd">            \right)</span>

<span class="sd">        and the following strain-rate tensor:</span>

<span class="sd">        .. math:: \bar{\epsilon} = \left(</span>
<span class="sd">            \begin{array}{ccc}</span>
<span class="sd">              \frac{\partial u_r}{\partial r} &amp;</span>
<span class="sd">              0&amp;</span>
<span class="sd">              \frac{1}{2}\left(\frac{\partial u_z}{\partial r}+</span>
<span class="sd">              \frac{\partial u_r}{\partial z}\right)\\</span>
<span class="sd">              0&amp;</span>
<span class="sd">               \frac{u_r}{r}&amp;</span>
<span class="sd">              0\\</span>
<span class="sd">              \frac{1}{2}\left(\frac{\partial u_r}{\partial z}</span>
<span class="sd">              +\frac{\partial u_z}{\partial r}\right)&amp;</span>
<span class="sd">              0&amp;</span>
<span class="sd">              \frac{\partial u_z}{\partial z}</span>
<span class="sd">            \end{array}</span>
<span class="sd">            \right)</span>

<span class="sd">        *Note*: The vector function space dimension is now two-dimensional.</span>
<span class="sd">        We can keep the 3D tensor notation if we perform the integrands</span>
<span class="sd">        manually before assembling the bilinear and linear forms.</span>

<span class="sd">        *Note*: The factor :math:`u_r/r` is problematic for</span>
<span class="sd">        :math:`r\approx 0`. One solution is to ...</span>

<span class="sd">        for axisymmetric flow, the velocity field is composed of two</span>
<span class="sd">        components, i.e.</span>

<span class="sd">        .. math:: \mathbf{u} = u_r\hat{\mathbf{e}}_r+u_z\hat{\mathbf{e}}_z</span>

<span class="sd">        **Splitting Method**:</span>

<span class="sd">        To overcome the saddle-point problems resulting from a direct</span>
<span class="sd">        discretization of the Navier-Stokes equations we use a splitting scheme</span>
<span class="sd">        where the velocity and pressure variables are computed in a sequence of</span>
<span class="sd">        predictor-corrector type steps.</span>

<span class="sd">        Incremental Pressure Correction Scheme (IPCS) -- see :cite:`Logg2012`</span>
<span class="sd">        for details of the algorithm.</span>

<span class="sd">        In summary, we may thus solve the incompressible Navier-Stokes</span>
<span class="sd">        equations efficiently by solving a sequence of three linear</span>
<span class="sd">        variational problems in each time step.</span>

<span class="sd">        In order to simulate steady-state use t_end = large number</span>

<span class="sd">        :param t_end: Final time, default = 10 s.</span>
<span class="sd">        :type t_end: ureg.Quantity</span>
<span class="sd">        :param num_steps: Number of time steps, default = 500.</span>
<span class="sd">        :type num_steps: int</span>
<span class="sd">        :return: The solution.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">out</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="n">dt</span> <span class="o">=</span> <span class="n">t_end</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="s1">&#39;s&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">magnitude</span> <span class="o">/</span> <span class="n">num_steps</span>
        <span class="n">radius</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_size</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">magnitude</span>
        <span class="n">length</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_size</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">magnitude</span>
        <span class="n">mu</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_mu</span><span class="o">.</span><span class="n">magnitude</span>
        <span class="n">rho</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_rho</span><span class="o">.</span><span class="n">magnitude</span>
        <span class="n">pin</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_pin</span><span class="o">.</span><span class="n">magnitude</span>

        <span class="c1"># TODO: something is odd with this mesh, needs investigations</span>
        <span class="n">mesh</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_mesh</span>

        <span class="n">dom</span> <span class="o">=</span> <span class="n">dolfin</span><span class="o">.</span><span class="n">cpp</span><span class="o">.</span><span class="n">mesh</span><span class="o">.</span><span class="n">MeshFunctionSizet</span><span class="p">(</span><span class="n">mesh</span><span class="p">,</span> <span class="n">mesh</span><span class="o">.</span><span class="n">mvc_dom</span><span class="p">())</span>
        <span class="n">bnd</span> <span class="o">=</span> <span class="n">dolfin</span><span class="o">.</span><span class="n">cpp</span><span class="o">.</span><span class="n">mesh</span><span class="o">.</span><span class="n">MeshFunctionSizet</span><span class="p">(</span><span class="n">mesh</span><span class="p">,</span> <span class="n">mesh</span><span class="o">.</span><span class="n">mvc_bnd</span><span class="p">())</span>
        <span class="n">dx</span> <span class="o">=</span> <span class="n">dolfin</span><span class="o">.</span><span class="n">Measure</span><span class="p">(</span><span class="s2">&quot;dx&quot;</span><span class="p">,</span> <span class="n">domain</span><span class="o">=</span><span class="n">mesh</span><span class="p">,</span> <span class="n">subdomain_data</span><span class="o">=</span><span class="n">dom</span><span class="p">)</span>
        <span class="n">ds</span> <span class="o">=</span> <span class="n">dolfin</span><span class="o">.</span><span class="n">Measure</span><span class="p">(</span><span class="s2">&quot;ds&quot;</span><span class="p">,</span> <span class="n">domain</span><span class="o">=</span><span class="n">mesh</span><span class="p">,</span> <span class="n">subdomain_data</span><span class="o">=</span><span class="n">bnd</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">out</span></div>

<div class="viewcode-block" id="PoiseuilleAxi.exact_solution"><a class="viewcode-back" href="../../../../package/cfd.html#cfd.models_2d.axi_symmetric.poiseuille_axi.PoiseuilleAxi.exact_solution">[docs]</a>    <span class="k">def</span> <span class="nf">exact_solution</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sa">r</span><span class="sd">&quot;&quot;&quot;This method is used to validate the finite element model.</span>

<span class="sd">        Here we assume that the flow is directed along the</span>
<span class="sd">        :math:`z`-direction (parallel to the tube walls), which leads to</span>
<span class="sd">        :math:`u_r=0`. The only external force acting on the fluid is gravity</span>
<span class="sd">        (:math:`\mathbf{F}\textrm{ext}=-\rho g_z\mathbf{\hat{e}}_z`).</span>

<span class="sd">        Using the axisymmetric formulation we have:</span>

<span class="sd">        continuity:</span>

<span class="sd">        .. math:: \frac{\partial}{\partial z} u_z = 0</span>

<span class="sd">        Navier-Stokes, :math:`r`-component:</span>

<span class="sd">        .. math::  \frac{\partial}{\partial r}p = 0</span>

<span class="sd">        Navier-Stokes, :math:`z`-component:</span>

<span class="sd">        .. math::  \rho\frac{\partial}{\partial t}u_z</span>
<span class="sd">             = -\frac{\partial}</span>
<span class="sd">            {\partial z}p +</span>
<span class="sd">            \mu\left(\frac{1}{r}\frac{\partial}{\partial r}\left(r</span>
<span class="sd">            \frac{\partial}{\partial r}u_z\right)\right) - \rho g_z</span>

<span class="sd">        When steady-state is reached, the term</span>
<span class="sd">        :math:`\frac{\partial}{\partial t}u_z=0`. Using the product rule</span>
<span class="sd">        we have:</span>

<span class="sd">        .. math::  \frac{\partial}{\partial z}p =</span>
<span class="sd">            \mu\left(\frac{1}{r}\frac{\partial}{\partial r}u_z +</span>
<span class="sd">            \frac{\partial^2}{\partial r^2}u_z</span>
<span class="sd">            \right)-\rho g_z</span>

<span class="sd">        with the following change of variable:</span>

<span class="sd">        .. math:: \phi = r\frac{\partial u_z}{\partial r}</span>

<span class="sd">        we have</span>

<span class="sd">        .. math:: \frac{\partial \phi}{\partial r} &amp;=</span>
<span class="sd">            \frac{\partial u_z}{\partial r} +</span>
<span class="sd">            r\frac{\partial^2u_z}{\partial r^2}\\</span>
<span class="sd">            &amp;= \frac{\phi}{r} + r\frac{\partial^2u_z}{\partial r^2}</span>

<span class="sd">        and</span>

<span class="sd">        .. math::  \frac{\partial}{\partial z}p =</span>
<span class="sd">            \mu\left(\frac{1}{r}\frac{\partial \phi}{\partial r}\right)-</span>
<span class="sd">            \rho g_z</span>

<span class="sd">        From :math:`\frac{\partial u_z}{\partial z} = 0`</span>
<span class="sd">        (:math:`\frac{\partial \phi}{\partial z} = 0`) and</span>
<span class="sd">        :math:`\frac{\partial p}{\partial r} = 0` we can solve the above</span>
<span class="sd">        equation by separation of variable, i.e.</span>

<span class="sd">        .. math::  \int dp =\int \left(\mu\left(\frac{1}{r}</span>
<span class="sd">            \frac{\partial \phi}{\partial r}\right)-\rho g_z\right)dz</span>

<span class="sd">        .. math::  \Delta p =</span>
<span class="sd">            \left(\mu\left(\frac{1}{r}\frac{\partial \phi}{\partial r}</span>
<span class="sd">            \right)-\rho g_z\right)\Delta z</span>

<span class="sd">        .. math::  \frac{\Delta p+</span>
<span class="sd">            \rho g_z\Delta z}{\mu \Delta z} =</span>
<span class="sd">            \frac{1}{r}\frac{\partial \phi}{\partial r}</span>

<span class="sd">        Where :math:`\Delta p = p(z=L+z_0) - p(z=z_0)`, and where</span>
<span class="sd">        :math:`\Delta z = z_0+L - z_0 = L`.</span>

<span class="sd">        By another separation of variable</span>

<span class="sd">        .. math::  \int \frac{\Delta p+</span>
<span class="sd">            \rho g_z\Delta z}{\mu \Delta z} r dr =</span>
<span class="sd">            \int d\phi</span>

<span class="sd">        which gives</span>

<span class="sd">        .. math::  \phi = \frac{1}{2}\frac{\Delta p+</span>
<span class="sd">            \rho g_z\Delta z}{\mu \Delta z}r^2 + C_1</span>

<span class="sd">        at :math:`r=0` we have :math:`\phi(0)=0` and :math:`C_1=0`.</span>
<span class="sd">        Substituting the value of :math:`\phi` in the above equation yields to:</span>

<span class="sd">        .. math::  r\frac{\partial u_z}{\partial r} = \frac{1}{2}</span>
<span class="sd">            \frac{\Delta p+\rho g_z\Delta z}{\mu \Delta z}r^2</span>

<span class="sd">        Integrating again on both sides gives:</span>

<span class="sd">        .. math::  u_z = \frac{1}{4}</span>
<span class="sd">            \frac{\Delta p+\rho g_z\Delta z}{\mu \Delta z}r^2 + C_2</span>

<span class="sd">        with :math:`u_z=0` at :math:`r=R`, we get</span>

<span class="sd">        .. math:: C_2 = -\frac{1}{4}</span>
<span class="sd">            \frac{\Delta p+\rho g_z\Delta z}{\mu \Delta z}r^2</span>

<span class="sd">        and</span>

<span class="sd">        .. math:: u_z = \frac{1}{4}</span>
<span class="sd">            \frac{\Delta p+\rho g_z\Delta z}{\mu \Delta z}\left(r^2-R^2\right)</span>

<span class="sd">        Rearranging the terms we get</span>

<span class="sd">        .. math:: u_z &amp;= \frac{1}{4}</span>
<span class="sd">            \frac{p(z=L)-p(z=z_0)+(\rho g_z(L-z_0)-\rho g_zz_0)}{\mu L}</span>
<span class="sd">            \left(r^2-R^2\right)\\</span>
<span class="sd">            &amp;= \frac{1}{4}</span>
<span class="sd">            \frac{(p(z=L)+\rho g_z(L-z_0))-(p(z=z_0)+\rho g_z z_0)}</span>
<span class="sd">            {\mu L}R^2\left(\left(\frac{r}{R}\right)^2-1\right)\\</span>
<span class="sd">            &amp;=\frac{1}{4}</span>
<span class="sd">            \frac{\mathcal{P}_L-\mathcal{P}_0}</span>
<span class="sd">            {\mu L}R^2\left(\left(\frac{r}{R}\right)^2-1\right)\\</span>
<span class="sd">            &amp;=\frac{1}{4}</span>
<span class="sd">            \frac{\mathcal{P}_0-\mathcal{P}_L}</span>
<span class="sd">            {\mu L}R^2\left(1-\left(\frac{r}{R}\right)^2\right)</span>

<span class="sd">        where :math:`\mathcal{P}_L=p(z=L)+\rho g_z(L-z_0)` and</span>
<span class="sd">        :math:`\mathcal{P}_0=p(z=z_0)+\rho g_zz_0`</span>

<span class="sd">        The pressure can be obtained using the Navier-Stokes,</span>
<span class="sd">        :math:`z`-component equation and the axial velocity :math:`u_z`,</span>
<span class="sd">        giving:</span>

<span class="sd">        .. math:: p = p(z=z_0) - \left(p(z=z_0)-p(z=L)\right)\frac{z}{L}</span>

<span class="sd">        For more info see :cite:`BSL2007` p. 88.</span>

<span class="sd">        :return: The solution, i.e. :math:`(p, u_z)` respectively along the</span>
<span class="sd">          center of the pipe line (symmetry axis), and along the radial</span>
<span class="sd">          distance.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">radius</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_size</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">height</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_size</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
        <span class="n">mu</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_mu</span>
        <span class="n">rho</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_rho</span>
        <span class="n">pin</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_pin</span>
        <span class="n">pout</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_pout</span>
        <span class="n">z</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">axial_line</span><span class="p">()</span>
        <span class="n">r</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">radial_line</span><span class="p">()</span>
        <span class="n">pl</span> <span class="o">=</span> <span class="n">pin</span> <span class="o">+</span> <span class="n">rho</span> <span class="o">*</span> <span class="n">Q_</span><span class="p">(</span><span class="n">g</span><span class="p">,</span> <span class="s1">&#39;m/s**2&#39;</span><span class="p">)</span> <span class="o">*</span> <span class="n">height</span>
        <span class="n">p0</span> <span class="o">=</span> <span class="n">pout</span> <span class="o">+</span> <span class="n">rho</span> <span class="o">*</span> <span class="n">Q_</span><span class="p">(</span><span class="n">g</span><span class="p">,</span> <span class="s1">&#39;m/s**2&#39;</span><span class="p">)</span> <span class="o">*</span> <span class="n">height</span>
        <span class="n">uz</span> <span class="o">=</span> <span class="mf">0.25</span> <span class="o">*</span> <span class="p">(</span><span class="n">p0</span> <span class="o">-</span> <span class="n">pl</span><span class="p">)</span> <span class="o">/</span> <span class="n">mu</span> <span class="o">/</span> <span class="n">height</span> <span class="o">*</span> <span class="n">radius</span><span class="o">**</span><span class="mi">2</span> <span class="o">*</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="p">(</span><span class="n">r</span> <span class="o">/</span> <span class="n">radius</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>
        <span class="n">p</span> <span class="o">=</span> <span class="n">pout</span> <span class="o">-</span> <span class="p">(</span><span class="n">pout</span> <span class="o">-</span> <span class="n">pin</span><span class="p">)</span> <span class="o">*</span> <span class="n">z</span> <span class="o">/</span> <span class="n">height</span>
        <span class="n">uz</span> <span class="o">=</span> <span class="n">uz</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="s1">&#39;m/s&#39;</span><span class="p">)</span>
        <span class="n">p</span> <span class="o">=</span> <span class="n">p</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="s1">&#39;Pa&#39;</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">p</span><span class="p">,</span> <span class="n">uz</span></div>

<div class="viewcode-block" id="PoiseuilleAxi.geom"><a class="viewcode-back" href="../../../../package/cfd.html#cfd.models_2d.axi_symmetric.poiseuille_axi.PoiseuilleAxi.geom">[docs]</a>    <span class="k">def</span> <span class="nf">geom</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sa">r</span><span class="sd">&quot;&quot;&quot;&quot;&quot;&quot;</span>
        <span class="n">geom</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">component</span><span class="p">(</span><span class="s1">&#39;comp&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">create</span><span class="p">(</span><span class="n">GEOMETRY</span><span class="p">,</span> <span class="s1">&#39;geom&#39;</span><span class="p">)</span>
        <span class="n">geom</span><span class="o">.</span><span class="n">create</span><span class="p">(</span><span class="n">RECTANGLE</span><span class="p">,</span> <span class="n">tag</span><span class="o">=</span><span class="s1">&#39;r1&#39;</span><span class="p">,</span> <span class="n">a</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_size</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">b</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_size</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
        <span class="n">geom</span><span class="o">.</span><span class="n">run</span><span class="p">()</span>
        <span class="k">return</span> <span class="n">geom</span></div>

<div class="viewcode-block" id="PoiseuilleAxi.mesh"><a class="viewcode-back" href="../../../../package/cfd.html#cfd.models_2d.axi_symmetric.poiseuille_axi.PoiseuilleAxi.mesh">[docs]</a>    <span class="k">def</span> <span class="nf">mesh</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sa">r</span><span class="sd">&quot;&quot;&quot;&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_geom</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">geom</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_geom</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">geom</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">geom</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_geom</span> <span class="o">=</span> <span class="n">geom</span>
        <span class="n">mesh</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">component</span><span class="p">(</span><span class="s1">&#39;comp&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">create</span><span class="p">(</span><span class="n">MESH</span><span class="p">,</span> <span class="s1">&#39;mesh&#39;</span><span class="p">,</span> <span class="n">geom_tag</span><span class="o">=</span><span class="n">geom</span><span class="o">.</span><span class="n">tag</span><span class="p">)</span>
        <span class="n">mesh</span><span class="o">.</span><span class="n">run</span><span class="p">()</span>
        <span class="k">return</span> <span class="n">mesh</span></div>

<div class="viewcode-block" id="PoiseuilleAxi.molecular_stress_tensor"><a class="viewcode-back" href="../../../../package/cfd.html#cfd.models_2d.axi_symmetric.poiseuille_axi.PoiseuilleAxi.molecular_stress_tensor">[docs]</a>    <span class="k">def</span> <span class="nf">molecular_stress_tensor</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">u</span><span class="p">,</span> <span class="n">p</span><span class="p">):</span>
        <span class="sa">r</span><span class="sd">&quot;&quot;&quot;Define the molecular stress tensor:</span>

<span class="sd">        .. math:: \bar{\pi} = 2\mu\bar{\epsilon}-p\bar{I}</span>

<span class="sd">        :param u: The velocity field.</span>
<span class="sd">        :param p: The pressure field.</span>
<span class="sd">        :return: The molecular stress tensor.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">mu</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_mu</span><span class="o">.</span><span class="n">magnitude</span>
        <span class="k">return</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">mu</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">strain_rate_tensor</span><span class="p">(</span><span class="n">u</span><span class="p">)</span> <span class="o">-</span> <span class="n">p</span> <span class="o">*</span> <span class="n">dolfin</span><span class="o">.</span><span class="n">Identity</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span></div>

<div class="viewcode-block" id="PoiseuilleAxi.radial_line"><a class="viewcode-back" href="../../../../package/cfd.html#cfd.models_2d.axi_symmetric.poiseuille_axi.PoiseuilleAxi.radial_line">[docs]</a>    <span class="k">def</span> <span class="nf">radial_line</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sa">r</span><span class="sd">&quot;&quot;&quot;Define a radial line on which the solution :math:`u_z` can be</span>
<span class="sd">        mapped (interpolated).&quot;&quot;&quot;</span>
        <span class="n">r</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_size</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">magnitude</span>
        <span class="k">return</span> <span class="n">Q_</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">r</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_ne_r</span> <span class="o">+</span> <span class="mi">1</span><span class="p">),</span> <span class="s1">&#39;m&#39;</span><span class="p">)</span></div>

<div class="viewcode-block" id="PoiseuilleAxi.strain_rate_tensor"><a class="viewcode-back" href="../../../../package/cfd.html#cfd.models_2d.axi_symmetric.poiseuille_axi.PoiseuilleAxi.strain_rate_tensor">[docs]</a>    <span class="k">def</span> <span class="nf">strain_rate_tensor</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">u</span><span class="p">):</span>
        <span class="sa">r</span><span class="sd">&quot;&quot;&quot;Define the symmetric strain-rate tensor</span>

<span class="sd">        :param u: The velocity field (2D).</span>
<span class="sd">        :return: The strain rate tensor.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">r</span> <span class="o">=</span> <span class="n">dolfin</span><span class="o">.</span><span class="n">SpatialCoordinate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_mesh</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">ur</span> <span class="o">=</span> <span class="n">u</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">uz</span> <span class="o">=</span> <span class="n">u</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
        <span class="n">ur_r</span> <span class="o">=</span> <span class="n">ur</span><span class="o">.</span><span class="n">dx</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
        <span class="n">ur_z</span> <span class="o">=</span> <span class="n">ur</span><span class="o">.</span><span class="n">dx</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
        <span class="n">uz_r</span> <span class="o">=</span> <span class="n">uz</span><span class="o">.</span><span class="n">dx</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
        <span class="n">uz_z</span> <span class="o">=</span> <span class="n">uz</span><span class="o">.</span><span class="n">dx</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">dolfin</span><span class="o">.</span><span class="n">sym</span><span class="p">(</span>
            <span class="n">dolfin</span><span class="o">.</span><span class="n">as_tensor</span><span class="p">(</span>
                <span class="p">[</span>
                    <span class="p">[</span><span class="n">ur_r</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mf">0.5</span> <span class="o">*</span> <span class="p">(</span><span class="n">uz_r</span> <span class="o">+</span> <span class="n">ur_z</span><span class="p">)],</span>
                    <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="n">ur</span> <span class="o">/</span> <span class="n">r</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span>
                    <span class="p">[</span><span class="mf">0.5</span> <span class="o">*</span> <span class="p">(</span><span class="n">uz_r</span> <span class="o">+</span> <span class="n">ur_z</span><span class="p">),</span> <span class="mi">0</span><span class="p">,</span> <span class="n">uz_z</span><span class="p">]</span>
                <span class="p">]))</span></div></div>
</pre></div>

          </div>
          
        </div>
      </div>
    <div class="clearer"></div>
  </div>
    <div class="footer">
      &copy;2020, Francois Roy.
      
    </div>

    

    
  </body>
</html>